    <!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ½ä¾†ç©ï¼èªæ³•æ¶ˆæ¶ˆæ¨‚</title>
    <style>
        /* (Styleéƒ¨åˆ†ä¿æŒä¸è®Š) */
        /* --- åŸºç¤æ¨£å¼ --- */
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f8ff;
            padding: 20px;
        }

        h1 { color: #4682b4; }
        #prompt { font-size: 18px; margin-bottom: 5px; color: #ff4500; font-weight: bold; }
        #instruction { margin-bottom: 20px; color: #333; font-size: 16px; }

        /* --- éŠæˆ²ç¶²æ ¼æ¨£å¼ --- */
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 85px); /* 4x4 ç¶²æ ¼ */
            grid-template-rows: repeat(4, 85px);
            gap: 5px;
            padding: 15px;
            background-color: #add8e6;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* --- æ–¹å¡Šæ¨£å¼ --- */
        .tile {
            width: 85px;
            height: 85px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 8px;
            cursor: grab;
            transition: opacity 0.3s, transform 0.1s;
            user-select: none;
        }

        .tile:hover { box-shadow: 0 0 8px rgba(0, 0, 0, 0.3); }
        
        /* æ ¸å¿ƒæ–¹å¡Šé¡è‰²ï¼Œä»¥åˆ©è¾¨è­˜ */
        .dou { background-color: #ffd700; border: 3px solid #ff8c00;} /* éƒ½ (é»ƒè‰²) */
        .subject, .complement { background-color: #b0e0e6; } /* ä¸»è© (è—è‰²) */
        .verb { background-color: #f08080; } /* å‹•è© (ç´…è‰²) */
        .connector { background-color: #98fb98; } /* å’Œ (ç¶ è‰²) */

        /* è¢«æ‹–æ›³ç‹€æ…‹ */
        .dragging { opacity: 0.5; transform: scale(1.05); }
        .hidden { visibility: hidden; } 

        /* --- ä¸‹æ–¹å¡«ç©ºæ¬„ä½ (6å€‹æ¬„ä½) --- */
        #sentence-slots {
            display: flex;
            margin-top: 30px;
            margin-bottom: 20px;
            width: 580px; 
            justify-content: space-between;
        }

        .slot {
            width: 80px;
            height: 80px;
            border: 2px dashed #4682b4;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .slot-tile {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fff;
            border: none;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        
        .slot-end {
            width: 30px;
            height: 80px;
            border: none;
            font-size: 40px;
            font-weight: bold;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        /* --- æŒ‰éˆ•èˆ‡ç‹€æ…‹ --- */
        #controls { margin-top: 10px; }
        .control-button {
            padding: 10px 20px;
            font-size: 18px;
            margin: 0 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        #check-button { background-color: #008000; color: white; border: none; }
        #check-button:hover { background-color: #006400; }
        
        #message-box {
            margin-top: 20px;
            font-size: 22px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            min-height: 40px;
        }
        .correct { color: white; background-color: #28a745; }
        .wrong { color: white; background-color: #dc3545; }

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        /* ... é€™æ˜¯æ‚¨åŸæœ‰çš„ CSS å€å¡Š ... */
    
    /* --- éŠæˆ²ç¶²æ ¼æ¨£å¼ --- */
    #game-board {
        display: grid;
        grid-template-columns: repeat(4, 75px); /* å„ªåŒ–ï¼š75px */
        grid-template-rows: repeat(4, 75px);    /* å„ªåŒ–ï¼š75px */
        gap: 4px; /* å„ªåŒ–ï¼š4px */
        padding: 15px;
        background-color: #add8e6;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* --- æ–¹å¡Šæ¨£å¼ --- */
    .tile {
        width: 75px;  /* å„ªåŒ–ï¼š75px */
        height: 75px; /* å„ªåŒ–ï¼š75px */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 16px; /* å„ªåŒ–ï¼š16px */
        font-weight: bold;
        color: #333;
        background-color: #fff;
        border: 2px solid #ccc;
        border-radius: 8px;
        cursor: grab;
        transition: opacity 0.3s, transform 0.1s;
        user-select: none;
    }
    /* ... (å…¶ä»–æ¨£å¼ä¿æŒä¸è®Š) ... */
    
    /* --- ä¸‹æ–¹å¡«ç©ºæ¬„ä½ (6å€‹æ¬„ä½) --- */
    #sentence-slots {
        display: flex;
        margin-top: 30px;
        margin-bottom: 20px;
        width: 480px; /* å„ªåŒ–ï¼š480px */ 
        justify-content: space-around; /* å„ªåŒ–ï¼šspace-around */
    }

    .slot {
        width: 75px; /* å„ªåŒ–ï¼š75px */
        height: 75px; /* å„ªåŒ–ï¼š75px */
        border: 2px dashed #4682b4;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }
    
    /* ... (å…¶ä»–æ¨£å¼ä¿æŒä¸è®Š) ... */
    
    /* --- æŒ‰éˆ•èˆ‡ç‹€æ…‹ --- */
    #controls { margin-top: 15px; } /* å„ªåŒ–ï¼šå¢åŠ é–“è· */
    
    .control-button {
        padding: 12px 25px; /* å„ªåŒ–ï¼šå¢å¤§é»æ“Šå€åŸŸ */
        font-size: 18px;
        margin: 0 10px;
        cursor: pointer;
        border-radius: 5px;
    }
    
    /* ------------------------------------- */
    /* ğŸš€ æ–°å¢ï¼šå°è¢å¹•ï¼ˆæ‰‹æ©Ÿï¼‰åª’é«”æŸ¥è©¢å„ªåŒ– */
    /* ------------------------------------- */
    @media (max-width: 500px) {
        body {
            padding: 10px;
        }
        
        #game-board, #sentence-slots {
            width: 100%;
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
        }

        #game-board {
            grid-template-columns: repeat(4, 65px); 
            grid-template-rows: repeat(4, 65px);
            gap: 3px;
            padding: 10px;
        }
        
        .tile {
            width: 65px;
            height: 65px;
            font-size: 14px;
        }
        
        #sentence-slots {
            margin-top: 20px;
            /* è®“æ’æ§½æ’åˆ—åœ¨å…©è¡Œ (3å€‹/3å€‹) ä»¥é©æ‡‰çª„è¢å¹• */
            width: 250px; 
            justify-content: space-between;
        }

        .slot {
            width: 65px;
            height: 65px;
            margin: 5px 3px; 
        }
        
        .slot-end {
            height: 65px;
            font-size: 30px;
        }
        
        #message-box {
            font-size: 18px;
            padding: 8px;
        }
    }
        /* --- åŸºç¤æ¨£å¼ --- */
body {
    /* ... å…¶ä»–å±¬æ€§ ... */
    user-select: none; /* é˜²æ­¢æ‰€æœ‰æ–‡å­—è¢«é¸å– */
    -webkit-user-select: none; /* é©ç”¨æ–¼èˆŠç‰ˆ WebKit ç€è¦½å™¨ï¼ˆå¦‚èˆŠç‰ˆ Safari/Chromeï¼‰*/
    -moz-user-select: none; /* é©ç”¨æ–¼ Firefox */
    -ms-user-select: none; /* é©ç”¨æ–¼ Internet Explorer/Edge */
}

/* --- æ–¹å¡Šæ¨£å¼ --- */
.tile {
    /* ... å…¶ä»–å±¬æ€§ ... */
    user-select: none; /* ç¢ºä¿æ–¹å¡Šå…§æ–‡å­—ç„¡æ³•é¸å– */
    /* ... å…¶ä»– user-select å±¬æ€§å·²åŒ…å«åœ¨ body ä¸­ï¼Œä½†é€™è£¡å†åŠ ä¸€æ¬¡æ›´ä¿éšª */
}
        /* --- åŸºç¤æ¨£å¼èˆ‡æ–‡å­—é¸å–ç¦ç”¨ --- */
body {
    font-family: 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #f0f8ff;
    padding: 20px;
    /* ğŸš€ ç¦ç”¨æ‰€æœ‰æ–‡å­—é¸å– */
    user-select: none; 
    -webkit-user-select: none; 
    -moz-user-select: none; 
    -ms-user-select: none; 
    touch-action: manipulation; /* å¢å¼·ç§»å‹•ç«¯éŸ¿æ‡‰ */
}

h1 { color: #4682b4; }
#prompt { font-size: 16px; margin-bottom: 5px; color: #ff4500; font-weight: bold; }
#instruction { margin-bottom: 15px; color: #333; font-size: 14px; }

/* --- éŠæˆ²ç¶²æ ¼èˆ‡æ–¹å¡Šæ¨£å¼ (æ‰‹æ©Ÿæ¡Œé¢é€šç”¨å„ªåŒ–) --- */
#game-board {
    display: grid;
    grid-template-columns: repeat(4, 75px); /* å„ªåŒ–ï¼š75px */
    grid-template-rows: repeat(4, 75px);    /* å„ªåŒ–ï¼š75px */
    gap: 4px; 
    padding: 15px;
    background-color: #add8e6;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.tile {
    width: 75px;  /* å„ªåŒ–ï¼š75px */
    height: 75px; /* å„ªåŒ–ï¼š75px */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px; 
    font-weight: bold;
    color: #333;
    background-color: #fff;
    border: 2px solid #ccc;
    border-radius: 8px;
    cursor: grab;
    transition: opacity 0.3s, transform 0.1s;
    user-select: none; /* ç¢ºä¿æ–¹å¡Šæ–‡å­—ç¦ç”¨é¸å– */
}

/* --- ä¸‹æ–¹å¡«ç©ºæ¬„ä½ (6å€‹æ¬„ä½) (æ‰‹æ©Ÿæ¡Œé¢é€šç”¨å„ªåŒ–) --- */
#sentence-slots {
    display: flex;
    margin-top: 30px;
    margin-bottom: 20px;
    width: 480px; /* é…åˆ 75px å¯¬åº¦èª¿æ•´ */ 
    justify-content: space-around; 
}

.slot {
    width: 75px; 
    height: 75px; 
    border: 2px dashed #4682b4;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.slot-end {
    width: 30px;
    height: 75px; /* èˆ‡ slot ä¿æŒä¸€è‡´ */
    border: none;
    font-size: 40px;
    font-weight: bold;
    display: flex;
    align-items: flex-end;
    justify-content: center;
}
 
/* --- æŒ‰éˆ•èˆ‡ç‹€æ…‹ (å„ªåŒ–é»æ“Šå€åŸŸ) --- */
#controls { margin-top: 15px; } 
.control-button {
    padding: 12px 25px; /* å¢å¤§é»æ“Šå€åŸŸ */
    font-size: 18px;
    margin: 0 10px;
    cursor: pointer;
    border-radius: 5px;
}

#message-box {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
    padding: 10px;
    border-radius: 5px;
    min-height: 40px;
}
/* ------------------------------------- */
/* ğŸš€ æ–°å¢ï¼šå°è¢å¹•ï¼ˆæ‰‹æ©Ÿï¼‰åª’é«”æŸ¥è©¢å„ªåŒ– */
/* ------------------------------------- */
@media (max-width: 500px) {
    body {
        padding: 10px;
    }
    
    #game-board, #sentence-slots {
        width: 100%;
        display: flex; 
        flex-wrap: wrap; 
        justify-content: center;
    }

    #game-board {
        grid-template-columns: repeat(4, 65px); /* é€²ä¸€æ­¥ç¸®å°åˆ° 65px */
        grid-template-rows: repeat(4, 65px);
        gap: 3px;
        padding: 10px;
    }
    
    .tile {
        width: 65px;
        height: 65px;
        font-size: 14px;
    }
    
    #sentence-slots {
        margin-top: 20px;
        /* é™åˆ¶ç¸½å¯¬åº¦ä»¥è§¸ç™¼æ›è¡Œï¼Œå¯¦ç¾ 2 è¡Œæ’åˆ— */
        width: 250px; 
        justify-content: space-between;
    }

    .slot {
        width: 65px;
        height: 65px;
        margin: 5px 3px; 
    }
    
    .slot-end {
        height: 65px;
        font-size: 30px;
    }
    
    #message-box {
        font-size: 16px;
        padding: 8px;
    }
}
        /* ------------------------------------- */
/* ğŸ¨ é‡æ–°å®šç¾©æ ¸å¿ƒæ–¹å¡Šé¡è‰² (ç¢ºä¿åœ¨åŸºç¤ .tile ä¹‹å¾Œ) */
/* ------------------------------------- */
.dou { 
    background-color: #ffd700 !important; 
    border: 3px solid #ff8c00 !important;
} 
.subject, .complement { 
    background-color: #fff !important; 
} 
.verb { 
    background-color: #f08080 !important; 
} 
.connector { 
    background-color: #98fb98 !important; 
} 

/* ç¢ºä¿æ‰‹æ©Ÿç‰ˆä¹Ÿå¸¶æœ‰é¡è‰² */
@media (max-width: 500px) {
    .dou { background-color: #ffd700 !important; border: 3px solid #ff8c00 !important; }
    .subject, .complement { background-color: #b0e0e6 !important; }
    .verb { background-color: #f08080 !important; }
    .connector { background-color: #98fb98 !important; }
}
    </style>
</head>
<body>

    <h1>éƒ½ä¾†ç©ï¼èªæ³•æ¶ˆæ¶ˆæ¨‚</h1>
    <div id="prompt">è«‹çµ„å‡ºä¸€å€‹ç”±**å…­å€‹**æ–¹å¡Šçµ„æˆçš„å®Œæ•´å¥å­ï¼Œå¡«å…¥ä¸‹æ–¹æ¬„ä½ã€‚</div>
    <div id="instruction">æç¤ºï¼šå°‡æ–¹å¡Šæ‹–æ›³è‡³ä¸‹æ–¹çš„æ¬„ä½ä¸­ã€‚é»æ“Šä¸‹æ–¹æ¬„ä½ä¸­çš„æ–¹å¡Šå¯å–æ¶ˆã€‚</div>
        <div id="instruction">ä¾‹å¥ï¼šæˆ‘å’Œä½ éƒ½è½éŸ³æ¨‚ã€‚</div>

    
    <div id="game-board">
    </div>

    <div id="sentence-slots">
        <div class="slot" id="slot-0"></div>
        <div class="slot" id="slot-1"></div>
        <div class="slot" id="slot-2"></div>
        <div class="slot" id="slot-3"></div>
        <div class="slot" id="slot-4"></div>
        <div class="slot" id="slot-5"></div>
        <div class="slot-end">ã€‚</div>
    </div>
    
    <div id="controls">
        <button id="check-button" class="control-button">å®Œæˆ</button>
    </div>

    <div id="message-box"></div>

    <script>
        // --- éŠæˆ²æ•¸æ“šèˆ‡è¨­å®š ---
        const GRID_SIZE = 16; 
        const SENTENCE_LENGTH = 6; 
        const boardElement = document.getElementById('game-board');
        const messageBox = document.getElementById('message-box');
        const checkButton = document.getElementById('check-button');

        // P: äººç‰©, D: é£²æ–™, S: é‹å‹•é …ç›®
        const vocabCategories = {
            'P': ['æˆ‘', 'ä½ ', 'ä»–', 'çˆ¸çˆ¸', 'åª½åª½', 'å§Šå§Š', 'å¦¹å¦¹', 'å“¥å“¥'],
            'D': ['å’–å•¡', 'çƒé¾èŒ¶'],
            // æ³¨æ„ï¼šå°‡ 'é›»å½±' å¾ S ç§»åˆ° COMPLEMENT æ›´åˆç†ï¼ŒS æ‡‰å°ˆæ³¨æ–¼é«”è‚²æ´»å‹•ã€‚
            'S': ['æ£’çƒ', 'ç¶²çƒ', 'ç±ƒçƒ', 'æ¸¸æ³³'], 
            // å…¶ä»–åŠŸèƒ½æ€§è©å½™
            'CONNECTOR': ['å’Œ'],
            'DOU': ['éƒ½'],
            'VERB_GENERIC': ['å–œæ­¡', 'å­¸', 'è½', 'çœ‹'], // å¢åŠ  'è¦ºå¾—' (èˆ‡ 'æ¼‚äº®' æ­é…æ›´è‡ªç„¶)
            'VERB_ACTION': ['æ‰“'], 
            'ADJ_VERB': ['å¥½'],
            'COMPLEMENT_MUSIC': ['éŸ³æ¨‚'],
            'COMPLEMENT': ['é›»å½±', 'é‹å‹•', 'æ¼‚äº®', 'å¥½ç©', 'ç©', 'å–', 'èŒ¶', 'çœ‹', 'è½'] // 'æ¼‚äº®' å’Œ 'é›»å½±'
        };
        
        // è¼”åŠ©å‡½æ•¸ï¼šæ ¹æ“šè©å½™ç²å–å…¶èªæ³•é¡åˆ¥
        function getVocabCategory(word) {
            for (const category in vocabCategories) {
                if (vocabCategories[category].includes(word)) {
                    return category;
                }
            }
            return 'OTHER';
        }
        
        // ç²å–æ‰€æœ‰ P/D/S é¡åˆ¥çš„è©å½™
        const subjectVocab = [...vocabCategories.P, ...vocabCategories.D, ...vocabCategories.S];

// çµåˆæ‰€æœ‰è©å½™å’Œå®ƒå€‘çš„é¡è‰²é¡å‹
Â  Â  Â  Â  const allVocab = [];
Â  Â  Â  Â  for (const cat in vocabCategories) {
Â  Â  Â  Â  Â  Â  // ğŸš€ æ›´æ–°ï¼šå°‡ COMPLEMENT_MUSIC è¦–ç‚º 'complement' é¡è‰²
Â  Â  Â  Â  Â  Â  const colorType = (cat === 'P' || cat === 'D' || cat === 'S' || cat === 'COMPLEMENT_MUSIC') ? 'subject' :Â  // é€™è£¡å°‡æ‰€æœ‰åè©éƒ½è¦–ç‚º subject é¡è‰²
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (cat.startsWith('VERB') || cat === 'ADJ_VERB') ? 'verb' :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (cat === 'CONNECTOR') ? 'connector' :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (cat === 'DOU') ? 'dou' : 'complement';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  vocabCategories[cat].forEach(word => {
Â  Â  Â  Â  Â  Â  Â  Â  allVocab.push({ text: word, type: colorType });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
        // --- å¥å‹æ¨¡æ¿è¦å‰‡ ---
Â  Â  Â  Â  const sentenceTemplates = [
Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  // 1. äººç‰© (P) çš„å‹•ä½œ
Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // P å’Œ P éƒ½ å–œæ­¡ D_CAT (S, D, COMPLEMENT, COMPLEMENT_MUSIC)
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'å–œæ­¡', D_CAT: ['S', 'D', 'COMPLEMENT', 'COMPLEMENT_MUSIC'] },Â 
Â  Â  Â  Â  Â  Â  // P å’Œ P éƒ½ å­¸ D_CAT (S, COMPLEMENT)
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'å­¸', D_CAT: ['S', 'COMPLEMENT'] },Â 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ğŸš€ é™åˆ¶ï¼šã€Œæ‰“ã€åªèƒ½å’Œæ£’çƒ/ç¶²çƒ/ç±ƒçƒé…å° (Sé¡åˆ¥)
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'æ‰“', D_CAT: ['S'] },Â 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ğŸš€ é™åˆ¶ï¼šã€Œè½ã€åªèƒ½å’ŒéŸ³æ¨‚é…å° (COMPLEMENT_MUSIC)
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'è½', D_CAT: ['COMPLEMENT_MUSIC'] },Â 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ğŸš€ é™åˆ¶ï¼šã€Œçœ‹ã€åªèƒ½å’Œé›»å½±é…å° (D_WORD = 'é›»å½±')
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'çœ‹', D_WORD: ['é›»å½±'] },Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // P å’Œ P éƒ½ å¥½ æ¼‚äº®
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'å¥½', D_CAT: ['COMPLEMENT'], D_WORD: ['æ¼‚äº®'] },Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // P å’Œ P éƒ½ è¦ºå¾— D (æ€éº¼æ¨£/æ¼‚äº®)
Â  Â  Â  Â  Â  Â  { A_TYPE: 'P', B_TYPE: 'P', C: 'è¦ºå¾—', D_CAT: ['COMPLEMENT'] },

Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  // 2. é£²æ–™ (D) - ã€Œå¥½ã€æ­é…
Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  Â  A_TYPE: 'D', B_TYPE: 'D', C: 'å¥½',Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸš€ é™åˆ¶ï¼šã€Œå¥½ã€åªèƒ½å’Œã€Œå–ã€é…å°
Â  Â  Â  Â  Â  Â  Â  Â  D_CAT: ['COMPLEMENT'],Â 
Â  Â  Â  Â  Â  Â  Â  Â  D_WORD: ['å–']Â 
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  // 3. é‹å‹• (S) - ã€Œå¥½ã€æ­é…
Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  Â  A_TYPE: 'S', B_TYPE: 'S', C: 'å¥½',Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸš€ é™åˆ¶ï¼šã€Œå¥½ã€åªèƒ½å’Œã€Œç©ã€é…å°
Â  Â  Â  Â  Â  Â  Â  Â  D_CAT: ['COMPLEMENT'],Â 
Â  Â  Â  Â  Â  Â  Â  Â  D_WORD: ['ç©']Â 
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  // 4. å…¶ä»–äº‹ç‰© (COMPLEMENT/COMPLEMENT_MUSIC) - ã€Œå¥½ã€æ­é…
Â  Â  Â  Â  Â  Â  // ------------------------------------
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  Â  A_TYPE: 'COMPLEMENT', B_TYPE: 'COMPLEMENT', C: 'å¥½',Â 
Â  Â  Â  Â  Â  Â  Â  Â  // é™åˆ¶ï¼š'é›»å½±'/'é‹å‹•' æ­é… 'å¥½çœ‹'ï¼Œå…¶ä»–åè©æ­é… 'å¥½ç©'ã€‚
Â  Â  Â  Â  Â  Â  Â  Â  D_CAT: ['COMPLEMENT'],Â 
Â  Â  Â  Â  Â  Â  Â  Â  D_WORD: ['çœ‹', 'ç©']Â 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  Â  A_TYPE: 'COMPLEMENT_MUSIC', B_TYPE: 'COMPLEMENT_MUSIC', C: 'å¥½',Â 
Â  Â  Â  Â  Â  Â  Â  Â  D_CAT: ['COMPLEMENT'],Â 
Â  Â  Â  Â  Â  Â  Â  Â  D_WORD: ['è½']Â // ğŸš€ é™åˆ¶ï¼šéŸ³æ¨‚åªèƒ½æ­é…ã€Œå¥½è½ã€
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  ];
        
        const validSubjectCategories = ['P', 'D', 'S', 'COMPLEMENT'];
        
        let currentTiles = []; 
        let slotContents = Array(SENTENCE_LENGTH).fill(null); 
        let eliminatedSentences = new Set();
        
        // --- é—œéµè©å½™ç”Ÿæˆé‚è¼¯ (ä¿æŒä¸è®Š) ---

        function getRandomSubjectGroup(existingVocabSet) {
            const groups = ['P', 'D', 'S'];
            const mainType = groups[Math.floor(Math.random() * groups.length)]; 
            
            let requiredWords = new Set();
            let mainVocabList = vocabCategories[mainType];
            
            let uniqueSubjects = shuffleArray([...mainVocabList]);
            if (uniqueSubjects.length >= 2) {
                requiredWords.add(uniqueSubjects[0]);
                requiredWords.add(uniqueSubjects[1]);
            } else if (uniqueSubjects.length === 1) {
                requiredWords.add(uniqueSubjects[0]);
                requiredWords.add(uniqueSubjects[0]);
            }

            const possibleTemplates = sentenceTemplates.filter(t => t.A_TYPE === mainType);
            if (possibleTemplates.length > 0) {
                const template = possibleTemplates[Math.floor(Math.random() * possibleTemplates.length)];
                requiredWords.add(template.C);
                
                const allComplement = vocabCategories.COMPLEMENT.concat(vocabCategories.S, vocabCategories.D).filter(w => !requiredWords.has(w));
                
                let dWord;
                
                if (template.D_WORD) {
                    dWord = template.D_WORD[Math.floor(Math.random() * template.D_WORD.length)];
                } else {
                    const potentialD = allComplement.filter(w => template.D_CAT.includes(getVocabCategory(w)));
                    dWord = potentialD.length > 0 ? potentialD[Math.floor(Math.random() * potentialD.length)] : vocabCategories.COMPLEMENT[0];
                }
                
                requiredWords.add(dWord);
            }

            return Array.from(requiredWords).filter(w => !existingVocabSet.has(w));
        }

        // --- 1. éŠæˆ²åˆå§‹åŒ– --- 

        function initializeGame() {
            boardElement.innerHTML = '';
            messageBox.textContent = '';
            messageBox.className = '';
            checkButton.disabled = false;
            eliminatedSentences.clear(); 
            
            refillBoard(true); 
            initializeSlots();
            checkButton.onclick = checkSentence;
        }

        // å¹«æ‰‹å‡½æ•¸ï¼šæ‰“äº‚é™£åˆ— (ä¿æŒä¸è®Š)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }



        // åˆå§‹åŒ–ä¸‹æ–¹æ‹–æ›³æ¬„ä½ (ä¿æŒä¸è®Š)
        function initializeSlots() {
            slotContents.fill(null);
            for(let i = 0; i < SENTENCE_LENGTH; i++) {
                const slot = document.getElementById(`slot-${i}`);
                slot.innerHTML = '';
                slot.ondragover = (e) => e.preventDefault();
                slot.ondrop = (e) => handleDrop(e, i);
            }
        }
        // **é‡è¦ï¼šæ–°çš„æ‰‹å‹•æ”¾ç½®å‡½æ•¸ï¼Œä¾›æ‰‹æ©Ÿè§¸æ‘¸ä½¿ç”¨**
function handleDropManual(originalTile, slotIndex) {
    const text = originalTile.dataset.text;

    slotContents[slotIndex] = { text, originalTile };

    const slotTile = document.createElement('div');
    const vocabItem = allVocab.find(v => v.text === text);
    slotTile.className = `slot-tile ${vocabItem.type}`;
    slotTile.textContent = text;
    
    slotTile.onclick = () => removeTileFromSlot(slotIndex);

    originalTile.classList.add('hidden');
    
    const slot = document.getElementById(`slot-${slotIndex}`);
    slot.innerHTML = '';
    slot.appendChild(slotTile);
}
        
        function handleDrop(e, slotIndex) {
            e.preventDefault();
            if (!draggedTile || slotContents[slotIndex] !== null) return;

            const text = draggedTile.dataset.text;
            const originalTile = draggedTile;

            slotContents[slotIndex] = { text, originalTile };

            const slotTile = document.createElement('div');
            const vocabItem = allVocab.find(v => v.text === text);
            slotTile.className = `slot-tile ${vocabItem.type}`;
            slotTile.textContent = text;
            
            slotTile.onclick = () => removeTileFromSlot(slotIndex);

            originalTile.classList.add('hidden');
            
            const slot = document.getElementById(`slot-${slotIndex}`);
            slot.innerHTML = '';
            slot.appendChild(slotTile);
        }
        
        function removeTileFromSlot(slotIndex) {
            if (slotContents[slotIndex] === null) return;

            const { originalTile } = slotContents[slotIndex];

            originalTile.classList.remove('hidden');

            document.getElementById(`slot-${slotIndex}`).innerHTML = '';
            slotContents[slotIndex] = null;
        }

        // --- 3. æª¢æŸ¥èˆ‡æ¶ˆé™¤é‚è¼¯ (ä¿æŒä¸è®Š) ---
        
        function checkSentence() {
            const assembledSentence = slotContents.map(c => c ? c.text : null);

            if (assembledSentence.includes(null)) {
                showMessage('è«‹çµ„å‡ºä¸€å€‹å®Œæ•´çš„å…­å€‹æ–¹å¡Šå¥å­ï¼', 'wrong');
                return;
            }
            
            if (assembledSentence[1] !== 'å’Œ' || assembledSentence[3] !== 'éƒ½') {
                 showMessage('èªæ³•çµæ§‹éŒ¯èª¤ï¼šè«‹ç¢ºèªã€Œå’Œã€èˆ‡ã€Œéƒ½ã€çš„ä½ç½®ï¼', 'wrong');
                 setTimeout(resetTiles, 1500); 
                 return;
            }

            const p1 = assembledSentence[0]; 
            const p3 = assembledSentence[2]; 
            const cWord = assembledSentence[4]; 
            const dWord = assembledSentence[5]; 

            const p1Type = getVocabCategory(p1);
            const p3Type = getVocabCategory(p3);
            const dType = getVocabCategory(dWord);

            let isCorrect = false;
            let currentSentenceKey = null;

            if (p1Type !== p3Type || !validSubjectCategories.includes(p1Type)) {
                showMessage('éŒ¯èª¤ï¼šA å’Œ B å¿…é ˆå±¬æ–¼ç›¸åŒçš„åè©é¡åˆ¥ã€‚', 'wrong');
                setTimeout(resetTiles, 1500); 
                return;
            }

            for (const template of sentenceTemplates) {
                if (p1Type !== template.A_TYPE || p3Type !== template.B_TYPE) continue;
                if (cWord !== template.C) continue;
                
                if (template.D_CAT && !template.D_CAT.includes(dType)) continue;

                if (template.D_WORD) {
                    if (!template.D_WORD.includes(dWord)) continue;
                }
                
                isCorrect = true;
                const sortedSubjects = [p1, p3].sort(); 
                currentSentenceKey = `${sortedSubjects[0]} å’Œ ${sortedSubjects[1]} éƒ½ ${cWord} ${dWord}`;
                break;
            }

            if (isCorrect) {
                if (eliminatedSentences.has(currentSentenceKey)) {
                    showMessage('é€™å€‹å¥å­å·²ç¶“æ¶ˆé™¤éäº†ï¼è«‹å˜—è©¦å…¶ä»–çµ„åˆã€‚', 'wrong');
                    setTimeout(resetTiles, 1500); 
                    return;
                }

                showMessage('ä½ ç­”å°äº†ï¼', 'correct');
                eliminatedSentences.add(currentSentenceKey); 
                eliminateTiles(assembledSentence);
            } else {
                showMessage('é€™å€‹çµ„åˆä¸ç¬¦åˆèªæ³•è¦å‰‡ï¼Œè«‹æª¢æŸ¥å‹•è©èˆ‡è£œèªçš„æ­é…ï¼', 'wrong');
                setTimeout(resetTiles, 1500); 
            }
        }

        // æˆåŠŸæ¶ˆé™¤ (ä¿æŒä¸è®Š)
        function eliminateTiles(assembledSentence) {
            
            const tilesToRemove = currentTiles.filter(tile => assembledSentence.includes(tile.dataset.text));

            tilesToRemove.forEach(tile => {
                if (tile.parentNode) {
                    tile.remove();
                }
            });
            
            initializeSlots();
            
            showMessage(`æˆåŠŸæ¶ˆé™¤ï¼å·²æ¶ˆé™¤ ${eliminatedSentences.size} å€‹å¥å­ã€‚`, 'correct');
            
            currentTiles = Array.from(boardElement.children);
            refillBoard(); 
        }
        
        // éŒ¯èª¤æ™‚å°‡æ–¹å¡Šæ­¸ä½ (ä¿æŒä¸è®Š)
        function resetTiles() {
            slotContents.forEach((content, index) => {
                if (content) {
                    content.originalTile.classList.remove('hidden');
                    document.getElementById(`slot-${index}`).innerHTML = '';
                }
            });
            initializeSlots();
            messageBox.textContent = '';
            messageBox.className = '';
        }
        
        // è£œå……æ–°æ–¹å¡Šä¸¦é‡æ–°ä½ˆå±€ (ä¿æŒä¸è®Š)
        function refillBoard(isInitial = false) {
            currentTiles = Array.from(boardElement.children);
            let existingVocab = currentTiles.map(tile => tile.dataset.text);
            let vocabSet = new Set(existingVocab);

            let requiredNext = ['éƒ½', 'å’Œ'];
            requiredNext.forEach(word => {
                if (!vocabSet.has(word)) { 
                    existingVocab.push(word); 
                    vocabSet.add(word);
                }
            });

            let seedWords = getRandomSubjectGroup(vocabSet);
            seedWords.forEach(word => {
                if (!vocabSet.has(word)) {
                    existingVocab.push(word);
                    vocabSet.add(word);
                }
            });
            
            let needToFill = GRID_SIZE - existingVocab.length;
            
            const allVocabTexts = allVocab.map(v => v.text);
            
            if (needToFill > 0) {
                let availableFillers = shuffleArray(allVocabTexts.filter(w => !vocabSet.has(w)));
                let fillerIndex = 0;

                for (let i = 0; i < needToFill; i++) {
                    let randomVocab;
                    if (availableFillers.length > fillerIndex) {
                        randomVocab = availableFillers[fillerIndex];
                        fillerIndex++;
                    } else {
                        randomVocab = allVocabTexts[Math.floor(Math.random() * allVocabTexts.length)];
                    }
                    existingVocab.push(randomVocab);
                }
            }
            
            existingVocab = existingVocab.slice(0, GRID_SIZE);

            boardElement.innerHTML = ''; 
            let newTilesVocab = shuffleArray(existingVocab);
            currentTiles = [];
            
            newTilesVocab.forEach(text => {
                const vocabDef = allVocab.find(v => v.text === text); 
                createTile(text, vocabDef ? vocabDef.type : 'subject');
            });
        }


        // è¨Šæ¯é¡¯ç¤º
        function showMessage(text, type) {
            messageBox.textContent = text;
            messageBox.className = type;
        }
<script>
Â  Â  Â  Â  // --- éŠæˆ²æ•¸æ“šèˆ‡è¨­å®š ---
Â  Â  Â  Â  const GRID_SIZE = 16;Â 
Â  Â  Â  Â  const SENTENCE_LENGTH = 6;Â 
Â  Â  Â  Â  // ... (å…¶ä»– const è®Šæ•¸) ...

Â  Â  Â  Â  let currentTiles = [];Â 
Â  Â  Â  Â  let slotContents = Array(SENTENCE_LENGTH).fill(null);Â 
Â  Â  Â  Â  let eliminatedSentences = new Set();
Â  Â  Â  Â Â 
        // ----------------------------------------------------
        // â­ è«‹å°‡æ‚¨æä¾›çš„ç¨‹å¼ç¢¼è²¼åœ¨é€™è£¡ (é€™æ˜¯å‡½æ•¸å¤–éƒ¨) â­
        // ----------------------------------------------------
Â  Â  Â  Â  // --- 2. æ‹–æ›³èˆ‡å¾©åŸé‚è¼¯ (æ•´åˆæ¡Œé¢èˆ‡æ‰‹æ©Ÿ) ---
Â  Â  Â  Â  let draggedTile = null; // æ³¨æ„ï¼šé€™è£¡æ‡‰è©²ä½¿ç”¨ 'let'
Â  Â  Â  Â  let currentSlot = null;Â // æ³¨æ„ï¼šé€™è£¡æ‡‰è©²ä½¿ç”¨ 'let'
Â  Â  Â  Â 
        // è«‹ç”¨é€™å€‹å‡½æ•¸æ›¿æ›æ‚¨æ‰€æœ‰é‡è¤‡çš„ setupDragEvents å‡½æ•¸å®šç¾©
Â  Â  Â  Â  function setupDragEvents(tile) {
Â  Â  Â  Â  Â  Â  // --- æ¡Œé¢ç‰ˆï¼ˆDrag Eventsï¼‰: é€™æ˜¯é›»è…¦æ‹–æ›³çš„é—œéµ ---
Â  Â  Â  Â  Â  Â  tile.ondragstart = (e) => {
                // ... (é€™è£¡æ˜¯ä½ æä¾›çš„æ‰€æœ‰ ondrag/ontouch é‚è¼¯) ...
Â  Â  Â  Â  Â  Â  Â  Â  currentSlot = null;
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
        // ----------------------------------------------------

Â  Â  Â  Â  // --- é—œéµè©å½™ç”Ÿæˆé‚è¼¯ (ä¿æŒä¸è®Š) ---
Â  Â  Â  Â  function getRandomSubjectGroup(existingVocabSet) { 
Â  Â  Â  Â  Â  Â  // ...
Â  Â  Â  Â  }
        
Â  Â  Â  Â  // --- 1. éŠæˆ²åˆå§‹åŒ– ---Â 
Â  Â  Â  Â  function initializeGame() {
Â  Â  Â  Â  Â  Â  // ...
Â  Â  Â  Â  }
Â  Â  Â  Â  // ... (æ¥ä¸‹ä¾†æ˜¯ createTile, initializeSlots, handleDropManual ç­‰å‡½æ•¸) ...
        // --- å•Ÿå‹•éŠæˆ² ---
        initializeGame();
    </script>
</body>
</html>
